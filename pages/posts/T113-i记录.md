---
title: T113-i记录
tags:
  - Linux
categories: Linux
date: 2025-10-24
updated: 2025-11-10
---

# T113-i记录

[[toc]]

<!-- more --> 

## 搭建环境

​`VMware17`  

​`Ubuntu18.04`

​`Tronlong T113-i`


1. 新版vmware不推荐安装vm-tools了，改用open-vm-tools

    ```bash
    sudo apt-get update
    sudo apt-get install open-vm-tools open-vm-tools-desktop -y
    ```

2. 共享文件夹的挂载与开机自启

    先在vmware虚拟机设置好共享文件夹

    ```bash
    vmware-hgfsclient   #查看共享的文件夹
    sudo vmhgfs-fuse .host:/vm_shared /mnt/hgfs -o allow_other
    #如果提示挂载过了,加一个 -o nonempty
        sudo vmhgfs-fuse .host:/vm_shared /mnt/hgfs -o nonempty -o allow_other
    #自动挂载
    sudo su
    vim /etc/fstab
    #添加一行   vm_shared是共享文件夹名 /mnt/hgfs是挂载点
    host:/vm_shared /mnt/hgfs fuse.vmhgfs-fuse allow_other 0 0
    #如果写错，重启后会进入紧急模式emergency
    ```

3. FTP服务

    Ubuntu作为FTP服务端，Windows为客户端(`FileZilla`​)，可以选择 `强制UTF-8`  

    ```bash
    sudo apt-get install vsftpd
    sudo vi /etc/vsftpd.conf
        local_enable=YES
        write_enable=YES
    sudo /etc/init.d/vsftpd restart
    ```

4. 虚拟机磁盘扩容

    先扩展虚拟机磁盘大小，然后进系统分配

    ```bash
    sudo apt-get install gparted
    #打开gparted
    #选择/dev/sda1 更改大小/移动 拉满 应用
    ```

5. 系统中文，文件夹英文(Desktop Downloads等等)

    ```bash
    export LANG=en_US
    xdg-user-dirs-gtk-update
    ```

6. SSH连接VM端VSCode

    先确保网络可以互ping通，安装 `Remote-SSH`​ 插件，`sudo apt-get install openssh-server`，

## 编译SDK

1. 把 `install_tools.sh` 拷入虚拟机

    ```bash
    sudo chmod +x ./install.sh
    ./install_tools.sh
    ```

    ​`install.sh` 如下：

    ```bash
    # /bin/sh
    sudo apt-get install texinfo -y
    sudo apt-get install pkg-config -y
    sudo apt-get install nfs-kernel-server -y
    sudo apt-get install samba -y
    sudo apt-get install ssh -y
    sudo apt-get install gcc -y
    sudo apt-get install autoconf -y
    sudo apt-get install patch -y
    sudo apt-get install wget -y
    sudo apt-get install texinfo -y
    sudo apt-get install zlib1g-dev -y
    sudo apt-get install dos2unix -y
    sudo apt-get install git -y
    sudo apt-get install gnupg -y
    sudo apt-get install flex -y
    sudo apt-get install bison -y
    sudo apt-get install gperf -y
    sudo apt-get install build-essential -y
    sudo apt-get install zip -y
    sudo apt-get install curl -y
    sudo apt-get install libc6-dev -y
    sudo apt-get install libncurses5-dev:i386 -y
    sudo apt-get install x11proto-core-dev -y
    sudo apt-get install libx11-dev:i386 -y
    sudo apt-get install libreadline6-dev:i386 -y
    sudo apt-get install libgl1-mesa-glx:i386 -y
    sudo apt-get install libgl1-mesa-dev -y
    sudo apt-get install g++-multilib -y
    sudo apt-get install tofrodos -y
    sudo apt-get install python-markdown -y
    sudo apt-get install libxml2-utils -y
    sudo apt-get install xsltproc -y
    sudo apt-get install zlib1g-dev:i386 -y
    sudo apt-get install gawk -y
    sudo apt-get install libssl-dev -y
    sudo apt-get install u-boot-tools:i386 -y
    echo "deb http://us.archive.ubuntu.com/ubuntu trusty main universe" | sudo tee -a /etc/apt/sources.list
    sudo apt update
    sudo apt-get install mingw32 -y
    sudo dpkg-reconfigure dash
    sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/i386-linux-gnu/libGL.so
    ```

2. 拷入 `LinuxSDK-v1.2.tar.gz`​ 和 `dl.tar.gz` 到共享文件夹里解压

    ```bash
    tar -zxvf /mnt/hgfs/LinuxSDK-v1.2.tar.gz -C ~/Desktop/t113/
    tar -xvf /mnt/hgfs/dl.tar.gz -C ~/Desktop/t113/tina5.0_v1.0/buildroot/buildroot-201902/
    ```

3. 配置编译环境

    ```bash
    cd tina5.0_v1.0/
    source ./build/envsetup.sh
    ./build.sh config
    #1.linux
    #1.buildroot
    #0.t113_i
    #4.tlt113-evm-emmc(emmc的选择)
    #0.hdmi
    #0.default
    ```

4. 编译打包

    ```bash
    #编译 -> out/
    ./build.sh
    #打包生成镜像
    ./build.sh pack
    ```

    如果中途编译报qt的错，修改 `qrandom.cpp`​ ，在221行注释添加 `typedef quint32 result_type;`

    ```bash
    ubuntu@ubuntu-vm:~$ find ~/Desktop/t113/tina5.0_v1.0/ -name qrandom.cpp
    /home/ubuntu/Desktop/t113/tina5.0_v1.0/out/t113_i/tlt113-evm-emmc/buildroot/buildroot/build/qt5base-5.11.3/src/corelib/global/qrandom.cpp
    ```

### 可配置项

1. build脚本config

    ```bash
    ./build.sh config
    ```

2. 配置内核选项

    ```bash
    # out/kernel/build/.config
    #安装 ncurses 库
    sudo apt-get install libncurses5-dev -y
    sudo apt-get install libncursesw5-dev -y
    #menuconfig
    ./build.sh menuconfig
    ```

3. 配置Buildroot

    ```bash
    # out/t113_i/tlt113-evm-emmc/buildroot/buildroot/.config
    ./build.sh buildroot_menuconfig

    #Qt5相关配置在
    "Target packages ---> Graphic libraries and applications (graphic/text) ---> Qt5 --->"
    ```

### 局部编译

1. SPL 和 U-Boot 编译

    ​`./build.sh bootloader`
2. 内核编译

    ​`./build.sh kernel`
3. 设备树编译

    ​`./build.sh config`
4. 文件系统编译

    ​`./build.sh buildroot_rootfs`

## 固化至emmc

1. 使用 `PhoenixSuit` 工具（Win11安装可能需要到win安全中心关闭内存完整性），点击Firmware，选择Linux镜像
2. 断电情况下，长按 USB0 UPGRADE(KEY1) 按键，将评估板上电，根据软件提示操作Yes OK

注：系统从 Flash 启动，需要把 SW2 打至 `0`

‍

## 设备驱动表

|设备名|Linux 内核驱动源码路径|Linux 设备文件或头文件|
| ----------------------------------------------| ------------------------| ------------------------|
|LED|​`drivers/leds/leds-gpio.c`|​`/sys/class/leds/user-ledX`|
|KEY (LRADC)|​`drivers/input/keyboard/sunxi-keyboard.c`|​`/dev/input/eventX`|
|USB TO UART0|​`drivers/tty/serial/sunxi-uart.c`|​`/dev/ttyS0`|
|RS485 (UART1 / UART3)|​`drivers/tty/serial/sunxi-uart.c`|​`/dev/ttyS1`​, `/dev/ttyS3`|
|RS232 (UART2)|​`drivers/tty/serial/sunxi-uart.c`|​`/dev/ttyS2`|
|TTL UART4 / UART5|​`drivers/tty/serial/sunxi-uart.c`|​`/dev/ttyS4`​, `/dev/ttyS5`|
|CAN0 / CAN1|​`drivers/net/can/sunxi_awlink.c`|​`/sys/class/net/awlinkX`|
|Micro SD / eMMC|​`drivers/mmc/host/sunxi-mmc.c`|​`/dev/mmcblkX`​, `/run/media/mmcblkX`|
|I2C|​`drivers/i2c/busses/i2c-sunxi.c`|​`/dev/i2c-X`|
|SPI|​`drivers/spi/spi-sunxi.c`|​`/sys/bus/spi`|
|SPI NAND FLASH|​`drivers/mtd/awnand/spinand/`|​`/dev/mtdX`​, `/dev/mtdblockX`|
|RTC (DS1307)|​`drivers/rtc/rtc-ds1307.c`|​`/dev/rtcX`|
|HP OUT / MIC / LINE IN|​`sound/soc/sunxi/sun8iw20-codec.c`<br />`sound/soc/sunxi/sun8iw20-sndcodec.c`<br />`sound/soc/sunxi/sunxi-dummy-cpudai.c`<br />`sound/soc/codecs/dmic.c`<br />`sound/soc/sunxi/sunxi-simple-card.c`|​`/dev/snd/controlC0`<br />`/dev/snd/pcmC0D0c`<br />`/dev/snd/pcmC0D0p`|
|Display Driver (MIPI/LVDS/TFT LCD/CVBS/HDMI)|​`drivers/video/fbdev/sunxi/disp2/`|​`/dev/fbX`​, `/dev/disp`|
|MIPI LCD|​`drivers/video/fbdev/sunxi/disp2/disp/lcd/aml070wxii4006.c`|​`/dev/fbX`​, `/dev/disp`|
|CAP TS (MIPI LCD)|​`drivers/input/touchscreen/gt9xxnew/`|​`/dev/input/eventX`|
|TFT LCD|​`drivers/video/fbdev/sunxi/disp2/disp/lcd/default_panel.c`|​`/dev/fbX`​, `/dev/disp`|
|LVDS LCD|​`drivers/video/fbdev/sunxi/disp2/disp/lcd/default_panel.c`|​`/dev/fbX`​, `/dev/disp`|
|HDMI OUT|​`drivers/video/fbdev/sunxi/disp2/disp/lcd/lt8912b.c`|​`/dev/fbX`​, `/dev/disp`|
|CVBS OUT|​`drivers/video/fbdev/sunxi/disp2/tv/`|​`/dev/fbX`​, `/dev/disp`|
|CVBS IN0 / CVBS IN1|​`drivers/media/platform/sunxi-tvd/`|​`/dev/video2`|
|USB HOST|​`drivers/usb/host/`|​`/sys/bus/usb/`|
|USB DRD|​`drivers/usb/sunxi_usb/manager/`<br />`drivers/usb/sunxi_usb/udc/`|​`/sys/bus/usb/`<br />`/sys/devices/platform/soc@3000000/soc@3000000:usbc0@0/`|
|4G Module (EC20)|​`drivers/usb/serial/option.c`<br />`drivers/net/usb/usbnet.c`<br />`drivers/net/ppp/ppp_generic.c`|​`/sys/class/net/usbX`​, `/dev/ttyUSBX`|
|USB WIFI (RTL8188)|—|​`/sys/class/net/wlanX`|
|ETH0 (RGMII)|​`drivers/net/ethernet/allwinner/sunxigmac.c`|​`/sys/class/net/ethX`|
|ETH1 (USB1)|​`drivers/net/usb/`|​`/sys/class/net/ethX`|
|HW Watchdog|​`drivers/gpio/gpiolib-sysfs.c`<br />`drivers/pinctrl/sunxi/pinctrl-sun8iw20.c`|​`/sys/class/gpio/gpioX/`|
|GPADC0 / GPADC1|​`drivers/input/sensor/sunxi_gpadc.c`|​`/sys/bus/iio/devices/iio:device0/in_voltageX_raw`|

备注："X"表示可变化的数值。

‍
